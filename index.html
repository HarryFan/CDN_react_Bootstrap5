<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- 載入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>

    <!-- 引入 Masonry 函式庫 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://masonry.desandro.com/masonry.pkgd.js"></script>


    <!-- 樣式設定 -->
    <style>
        body {
            background-image: url('./public/背景圖片.jpg');
            /* 設定圖片路徑 */
            background-size: cover;
            /* 調整圖片大小以填滿整個背景 */
            background-repeat: no-repeat;
            /* 防止圖片重複顯示 */
            background-attachment: fixed;
            /* 固定圖片，使其在滾動時保持不變 */
        }

        .card {
            background-color: #696969;
            border-radius: 10px;
            /* 設定圓角半徑，你可以根據需要進行調整 */
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);
            /* 調整數值以獲得適合的陰影效果 */
            transition: background-color 0.3s ease;
        }

        .card h2 {
            text-align: center;
            /* 標題水平置中 */
            margin: 0 auto;
            /* 標題垂直置中（使用 margin:auto 將其置於中間） */
            display: flex;
            justify-content: center;
            /* 垂直置中 */
            align-items: center;
            /* 水平置中 */
            height: 100%;
            /* 設定標題的高度為 100% */
            color: white;
        }

        .card-frame {
            flex: 0 0 auto;
            width: 33.33333333%;
            padding: 5px;
        }

        .card-body img {
            background-color: #FFFFFF;
            width: 100%;
            height: auto;
            padding: 0px;
            border: none;
            /* 移除實線邊框 */
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
            /* 添加陰影效果 */
        }

        .card.cardIsHover {
            background-color: #ffffff;
        }

        .cardIsHover h2 {
            color: black;
            /* 鼠標懸停時的文字顏色 */
        }
    </style>

</head>

<body>
    <!-- React 掛載點 -->
    <div id="root"></div>

    <script type="text/babel">

      

        // 在 CardForm 組件中
        function CardForm({ onSubmit, setImagesList }) {  // 加入 setImagesList 作為組件的屬性
            const [title, setTitle] = React.useState('');
            const [link, setLink] = React.useState('');
            const [selectedImage, setSelectedImage] = React.useState(null);

            const handleImageChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setSelectedImage(event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();

                // 創建新的卡片對象
                const newCard = {
                    title: title,
                    logoImgURL: selectedImage, // 使用上傳的圖片 URL
                    link: link
                };

                // 將新的卡片加入圖片列表數據
                setImagesList(prevImages => [...prevImages, newCard]);

                // 強制重新渲染主應用組件
                ReactDOM.render(
                    <App />,
                    document.getElementById('root')
                );

                // 清空表單輸入和已選擇的圖片
                setTitle('');
                setLink('');
                setSelectedImage(null);

            

            };

            return (
                <div className="card">
                    <h2>新增卡片</h2>
                    <div className="card-body">
                        <form onSubmit={handleSubmit}>
                            <div className="mb-3">
                                <label className="form-label">Title</label>
                                <input type="text" className="form-control" value={title} onChange={(e) => setTitle(e.target.value)} required />
                            </div>
                            <div className="mb-3">
                                <label className="form-label">Select Image</label>
                                <input type="file" accept="image/*" onChange={handleImageChange} />
                            </div>
                            {selectedImage && <img src={selectedImage} alt="Selected" style={{ maxWidth: '100px' }} />}
                            <div className="mb-3">
                                <label className="form-label">Link</label>
                                <input type="url" className="form-control" value={link} onChange={(e) => setLink(e.target.value)} required />
                            </div>
                            <button type="submit" className="btn btn-primary">點擊送出</button>
                        </form>
                    </div>
                </div>
            );
        }

        // 卡片組件
        function Card(props){ // Card 屬性有 image 第 68 行 (前面的 image)
            const [isHovered, setIsHovered] = React.useState(false);

            const handleMouseOver = () => {
                setIsHovered(true);
            };
            const handleMouseOut = () => {
                setIsHovered(false);
            };
            // Card 組件下的屬性 image 又包含屬性 link, title, logoImgURL
            return (
                // 必須使用反引號 `` 才能使 Jquery 語法被解析, 不可使用 ""
                <>
                <div className={`card ${isHovered ? 'cardIsHover' : ''}`}>
                    <h2 className={`${isHovered ? 'cardIsHover' : ''}`} 
                        style={{padding: '10px'}}>
                        {props.image.title}
                    </h2>
                    <div className="card-body">
                        <a href={props.image.link}>
                            <img onMouseOver={handleMouseOver}
                                onMouseOut={handleMouseOut} 
                                src={props.image.logoImgURL} 
                                alt={props.image.title} 
                                style={{padding: '10px'}} />
                        </a>
                    </div>
                </div>
                </>
            );
        }
        
        // 主應用組件
        

function App() {
 

    // 圖片列表數據
    const [imagesList, setImagesList] = React.useState([
        { title: "小觀音山O型縱走", logoImgURL: "./public/小觀音山.jpeg", link: "https://hiking.biji.co/index.php?q=review&act=info&review_id=13378" },
        { title: "大屯山系O型縱走", logoImgURL: "./public/大屯山.jpeg", link: "https://hiking.biji.co/index.php?q=trail&act=gpx_detail&id=28711" },
        { title: "三進三出七星山", logoImgURL: "./public/七星山.jpeg", link: "https://hiking.biji.co/index.php?q=review&act=info&review_id=28816" },
        { title: "苗栗加里山之旅", logoImgURL: "./public/加里山.jpg", link: "https://hiking.biji.co/index.php?q=trail&act=detail&id=249" }
    ]);


            React.useEffect(() => {
        // 確保Masonry已經初始化
        if ($('.card-list').data('masonry')) {
            $('.card-list').masonry('reloadItems').masonry('layout');
        } else {
            $('.card-list').masonry({
                itemSelector: '.card-frame'
            });
        }
    }, [imagesList]); // 當 imagesList 更新時觸發
    
            return (
                <div className="container">
                    <div className="card-list">
                        {imagesList.map((image, index) => (  // 這裡的 image 就是 imagesList 中的每一個元素
                            <div className="card-frame" key={index}>  
                                <Card image={image} /> 
                            </div>
                        ))}
                    </div>
                    <div className="row">
                        <div className="col">
                            <CardForm imagesList={imagesList} setImagesList={setImagesList} />
                        </div>
                    </div>
                </div>
            );
        }
       
        // 除錯代碼
        console.log("Debugging...");

        // React 初始化代碼
        ReactDOM.render(
            <App />,
            document.getElementById('root')
        );
    </script>

    <script>
       
        $(window).on("load", function() {
            // 使用 Masonry 函式庫初始化磚牆佈局
          
            $('.card-list').masonry({
                itemSelector: '.card-frame'
            });
      
        });
    </script>

</body>

</html>